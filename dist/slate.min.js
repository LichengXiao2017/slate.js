// Boost Browser and DOM Tools
// (c) 2015, Mathigon / Philipp Legner
// MIT License (https://github.com/Mathigon/slate.js/blob/master/LICENSE)

!function(){M.audio={files:{},playing:null,load:function(a,b){return M.audio.files[b]=new Audio(a),M.audio.files[b].load(),M.audio.files[b].addEventListener("timeupdate",function(){M.audio.playing&&M.audio.playing.update()}),M.audio.files[b]}},M.audio.Chunk=M.Class.extend({init:function(a,b){M.isString(b)&&(b=M.map(parseFloat,b.split("|"))),this.times=b,this.currentTime=b[0],this.duration=b[1]-b[0],this.player=M.audio.files[a]||M.audio.load(a,Math.floor(1e4*Math.random())),this.status="paused"},play:function(){var a=this;return this.player.readyState<2?void $(this.player).one("canplay seeked",function(){a.play()}):(M.audio.playing&&M.audio.playing.pause(),M.audio.playing=this,this.status="playing",this.player.currentTime=this.currentTime,this.player.play(),void this.trigger("play",{p:(this.currentTime-this.times[0])/this.duration,t:this.currentTime}))},pause:function(){this.status="paused",M.audio.playing===this&&this.player.pause(),this.trigger("pause")},setTime:function(a){this.player.readyState&&(this.player.currentTime=a),this.trigger("timeupdate",{p:(a-this.times[0])/this.duration,t:a})},reset:function(){M.audio.playing===this&&this.player.pause(),this.player.readyState&&(this.currentTime=this.times[0]),this.status="paused",this.trigger("reset")},update:function(){return"ended"!==this.status?(M.audio.playing===this&&(this.currentTime=this.player.currentTime),this.currentTime>=this.times[1]?(this.pause(),this.status="ended",void this.trigger("end")):void this.trigger("timeupdate",{p:(this.currentTime-this.times[0])/this.duration,t:this.currentTime})):void 0}}),M.speechRecognition=function(){if(!M.browser.speechRecognition)return{start:function(){a.start()},stop:function(){a.stop()},addCommand:function(){},removeCommand:function(){},available:!1};var a=new window.webkitSpeechRecognition;a.continuous=!0,a.language="en-US";var b={},c=function(a){a=a.toLowerCase().trim(),b[a]&&b[a]()};a.onresult=function(a){for(var b=a.resultIndex;b<a.results.length;++b)console.debug("Voice Input: ",a.results[b][0].transcript),c(a.results[b][0].transcript)};var d=function(a,c){a instanceof Array||(a=[a]);for(var d=0;d<a.length;++d)b[a[d].toLowerCase()]=c},e=function(a){a instanceof Array||(a=[a]);for(var c=0;c<a.length;++c)b[a[c].toLowerCase()]=void 0};return{start:function(){a.start()},stop:function(){a.stop()},addCommand:d,removeCommand:e,available:!0}},M.Popup=function(a,b){var c=this,d=$C("popup-bubble",a);if(d){var e=$C("bubble-box",d);$N("span",{"class":"bubble-arrow"},d),c.open=function(){b.activePopup&&b.activePopup.close(),d.css("display","block");var f=d.$el.getBoundingClientRect(),g=f.top-f.height,h=f.left-f.width/2,i=f.right+f.width/2,j=b.$container.offset().left,k=M.browser.width;j+10>h&&e.translateX(j+10-h),i>k-54&&e.translateX(k-54-i),M.redraw(),27>g&&b.scrollBy(g-27),a.addClass("on"),b.activePopup=c},c.close=function(){a.removeClass("on"),b.activePopup=null,setTimeout(function(){d.css("display","none")},200)},c.delete=function(){a.off("click",f)};var f=function(b){b.preventDefault(),b.stopPropagation(),a.hasClass("on")?c.close():c.open()};d.click(function(a){a.stopPropagation()}),a.click(f)}},M.Gallery=M.Class.extend({init:function(a,b){b||(b={});var c=this,d=$N("div",{"class":"gallery-wrapper"}),e=$N("div",{"class":"gallery-box"});a.wrap(d),d.wrap(e);var f,g,h,i=a.children(),j=i.length,k=a.attr("data-slide-width")||null,l=0,m=0,n=$N("div",{"class":"gallery-next"},e),o=$N("div",{"class":"gallery-back"},e);$N("div",{"class":"icon"},n),$N("div",{"class":"icon"},o);var p=$N("div",{"class":"gallery-dots"},e),q=[];i.each(function(a){a.addClass("gallery-slide"),q.push($N("div",{"class":"gallery-dot"},p))});var r,s,t,u,v=function(b){m=b,a.translateX(b),c.trigger("move",b)},w=function(a){l=a,q.each(function(b,c){b.setClass("on",c>=a&&a+g>c)}),b.callback&&b.callback(a),n.setClass("disabled",a===j-g),o.setClass("disabled",0===a),c.trigger("change",a)},x=function(){f=d.width("border"),g=k?Math.ceil(f/k):1,h=f/g,i.each(function(a){a.css("width",h+"px")}),a.css("width",j*h+"px"),v(-l*h),w(l)},y="quad",z=500,A=!1,B=function(){r=M.now()-u,v(s+t*M.easing(y,r/z))},C=function(){!A&&z>r&&M.animationFrame(C),B()},D=function(a){A=!1,r=0,s=m,t=-a*h-m,u=M.now(),w(a),C()},E=function(){y="quad",j-g>l&&(n.pulseDown(),D(l+1))},F=function(){y="quad",l>0&&(o.pulseDown(),D(l-1))};n.click(E),o.click(F);var G=null,H=null,I=null,J=null,K=function(){M.$body.on("mousemove touchmove",L),M.$body.on("mouseup mouseleave touchend touchcancel",N),A=!0,G=m,H=event.touches?event.touches[0].clientX:event.clientX,J=I=H},L=function(a){a.preventDefault();var b=event.touches?event.touches[0].clientX:event.clientX;I=J,J=b;var c=G-H+b,d=-(j-g)*h;v(c>0?c/4:d>c?d+(c-d)/4:c)},N=function(){M.$body.off("mousemove touchmove",L),M.$body.off("mouseup mouseleave touchend touchcancel",N);var a=(event.touches?event.touches[0].clientX:event.clientX,J-I),b=a>12?1:-12>a?-1:0;y="quad-out",D(M.bound(Math.round(-m/h-b),0,j-g))};d.on("mousedown touchstart",K),x(),M.resize(x),this.next=E,this.back=F}}),M.Frame=M.Class.extend({init:function(a){function b(){setTimeout(function(){var b=f.width("border"),d=b*e;f.css("height",d+"px"),a.transform("scale("+b/c+") translateZ(0)")})}var c=a.width("border"),d=a.height("border"),e=d/c,f=$N("div",{"class":"frame-wrap"});a.wrap(f),M.resize(b)}}),M.scrollReveal=function(a){function b(){g=window.innerHeight}function c(){h=window.pageYOffset}function d(a,b){var c=a.$el.offsetTop,d=a.$el.offsetHeight;return c+d>=h+b*g&&h+(1-b)*g>=c}function e(a){function b(){e=!0,a.css("opacity","1"),a.transform("translate"+g+"(0)")}function c(){e=!1,a.css("opacity","0"),a.transform("translate"+g+"("+h+j+")")}var e=!0,f=(a.attr("data-scroll")||"").split("|"),g=M.isOneOf(f[0],"left","right")?"X":"Y",h=M.isOneOf(f[0],"top","left")?"-":"",i=M.isNaN(+f[1])?.2:+f[1],j=f[2]||"40px",k=f[3]||".5s",l=f[4]||"0s";return a.transition(["opacity",k,l,",",M.prefix("transform"),k,l].join(" ")),function(){!e&&d(a,i)&&b(),e&&!d(a,0)&&c()}}function f(){c();for(var a=0;j>a;++a)i[a]()}if(!(M.browser.isMobile&&M.browser.width<800&&M.browser.height<800)){var g;M.resize(b),b();var h,i=a.each(function(a){return e(a)}),j=i.length;M.$body.scroll(f),M.resize(f),f(),setTimeout(function(){f()},500)}},M.Draggable=M.Class.extend({init:function(a,b,c,d){var e,f,g=this,h="y"!==c,i="x"!==c,j=[0,0],k=[null,null],l=function(a){return[event.touches?a.touches[0].clientX:a.clientX,event.touches?a.touches[0].clientY:a.clientY]},m=function(b,c){h&&a.css("left",Math.round(b)+"px"),i&&a.css("top",Math.round(c)+"px"),g.trigger("change",{x:b,y:c,width:e,height:f})};this.set=function(a,b){m(a,b),j=[a,b]},this.get=function(){return{x:j[0],y:j[1],width:e,height:f}};var n=function(a){M.$body.on("mousemove touchmove",o),M.$body.on("mouseup mouseleave touchend touchcancel",p),k=l(a),g.trigger("start")},o=function(a){a.preventDefault();var b=l(a),c=M.bound(j[0]+b[0]-k[0],0,e),d=M.bound(j[1]+b[1]-k[1],0,f);m(c,d)},p=function(a){M.$body.off("mousemove touchmove",o),M.$body.off("mouseup mouseleave touchend touchcancel",p);var b=l(a);if(b[0]===k[0]&&b[1]===k[1])g.trigger("click");else{var c=M.bound(j[0]+b[0]-k[0],0,e),d=M.bound(j[1]+b[1]-k[1],0,f);j=[c,d],g.trigger("end")}};a.on("mousedown touchstart",n);var q=function(){var a=e,c=f;e=b.width("border")-2*d,f=b.height("border")-2*d,g.set(e/(a||e)*j[0],f/(c||f)*j[1])};q(),M.resize(q)}}),M.Slider=M.Class.extend({init:function(a,b){var c=this;a.addClass("slider-track");var d=$N("div",{"class":"slider-knob"},a);$N("div",{"class":"icon"},d);var e,f=new M.Draggable(d,a,"x",4);f.on("start",function(){g=!0}),f.on("change",function(a){var d=Math.floor(a.x/a.width*b);d!==e&&c.trigger("move",d),e=d});var g=!1;f.on("click",function(){c.play()});var h=function(){var a=f.get();!g&&a.x<a.width&&M.animationFrame(h),f.set(a.x+2)};this.play=function(){g=!1,d.pulseDown(),h()},f.set(0,0)}}),M.ImageSequence=M.Class.extend({init:function(a){var b=$N("div");a.wrap(b);for(var c=a.attr("data-src"),d=Number(a.attr("data-pages"))-1,e=$N("div",{},b),f=new M.Slider(e,d),g=[],h=1;d>h;++h)g[h]=new Image,g[h].src=c.replace("#",h);f.on("move",function(b){a.attr("src",c.replace("#",b))}),f.trigger("move",0)}}),M.Variable=M.Class.extend({init:function(a,b){var c=this,d=b.varValues,e=a,f=new Function("_vars","with(_vars){ return "+a.html()+"; }");if(this.on("change",function(){try{e.html(f(d))}catch(a){console.debug(f,a)}}),b.on("ready",function(){c.trigger("change",d[h])}),a.attr("data-var")){a.addClass("var");var g=a.attr("data-var").split("|"),h=g[0],i=g[1],j=g[2],k=g[3]?g[3].split(","):[];a.html("");var l=function(){b.vars.each(function(a){a.trigger("change",d[h])})};if("slider"===j){d[h]=Number(i),a.addClass("var-slider"),k[0]=Number(k[0]),k[1]=Number(k[1]),k[2]=Number(k[2]),e=$N("span",{"class":"var-slider-text"},a),$N("span",{"class":"left"},a),$N("span",{"class":"right"},a);var m=$N("span",{"class":"var-slider-bubble"},a),n=$N("span",{"class":"var-slider-bubble-box "},m),o=$N("span",{"class":"var-slider-progress"},n);$N("span",{"class":"var-slider-bubble-arrow"},m),o.css("width",116*(d[h]-k[0])/(k[1]-k[0])+"px");var p=0,q=0,r=0,s=Math.sqrt(k[2]/(k[1]-k[0])*1e3)+(M.browser.isTouch?10:2),t=function(a){a.stopPropagation(),a.preventDefault(),p=a.pageX||a.originalEvent.touches[0].pageX,q=d[h],m.css("display","block"),M.redraw(),m.addClass("on"),M.$body.on("touchmove mousemove",u),M.$body.on("touchend touchcancel mousecancel mouseup",v)},u=function(a){a.stopPropagation(),a.preventDefault(),r=(a.pageX||a.originalEvent.touches[0].pageX)-p;var b=d[h];d[h]=Math.round(Math.max(k[0],Math.min(k[1],q+r/s))/k[2])*k[2],o.css("width",116*(d[h]-k[0])/(k[1]-k[0])+"px"),b!==d[h]&&l()},v=function(){m.removeClass("on"),setTimeout(function(){m.css("display","none")},200),M.$body.off("touchmove mousemove",u),M.$body.off("touchend touchcancel mousecancel mouseup",v)};a.on("touchstart mousedown",t)}else if("bolean"===j)d[h]=!!Number(i),a.click(function(){d[h]=!!d[h],l()});else if("switch"===j){d[h]=i;var w=0,x=k.length-1;a.click(function(){x>w?++w:w=0,d[h]=k[w],l()})}}}}),M.$.prototype.setPoints=function(a){this.attr("d",a.length?"M"+a.each(function(a){return a.x+","+a.y}).join("L"):""),this.points=a},M.$.prototype.addPoint=function(a){this.getPoints(),this.attr("d",this.attr("d")+" L "+a.x+","+a.y),this.points.push(a)},M.$.prototype.getPoints=function(){if(!this.points){var a=this.$el.attr("d").replace("M","").split("L");this.points=a.each(function(a){return p=a.split(","),new M.geo.Point(p[0],p[1])})}return this.points},M.piechart=function(a,b,c){if(a>=1)return['<svg width="',2*b,'" height="',2*b,'">','<path fill="',c,'" stroke="none" d="M',b,",0C",.5*b,",0,0,",.5*b,",0,",b,"s",.5*b,",",b,",",b,",",b,"s",b,"-",.5*b,",",b,"-",b,"S",1.5*b,",0,",b,",0","z M",44.6*b/50,",",76.1*b/50,"L",19.2*b/50,",",48.8*b/50,"l",4*b/50,"-",4.2*b/50,"l",19.8*b/50,",",11.9*b/50,"l",34.2*b/50,"-",32.6*b/50,"l",3.5*b/50,",",3.5*b/50,"L",44.6*b/50,",",76.1*b/50,'z"/>',"</svg>"].join("");var d=b+b*Math.sin(2*a*Math.PI),e=b-b*Math.cos(2*a*Math.PI);return['<svg width="',2*b,'" height="',2*b,'">','<circle cx="',b,'" cy="',b,'" r="',b-.5,'" stroke="',c,'" stroke-width="1" fill="transparent"/>','<path d="M ',b," ",b," L ",b," 0 A ",b," ",b," 0 "+(a>.5?"1":"0")+" 1 "+d+" "+e+' Z" fill="',c,'"/>',"</svg>"].join("")},M.Draw=M.Class.extend({init:function(a,b){var c=this;a.addClass("m-draw-pointer"),this.$svg=a,this.options=b=b||{},this.drawing=!1,this.paths=[],this.p=null,this.activePath=null,b.noStart||a.on("mousedown touchstart",function(b){b.preventDefault(),b.stopPropagation();var d=M.events.pointerOffset(event,a);c.start(d)}),a.on("mousemove touchmove",function(b){if(c.drawing){b.preventDefault(),b.stopPropagation();var d=M.events.pointerOffset(event,a);c.addPoint(d)}}),a.on("mouseup touchend mouseleave touchleave",function(){c.trigger("end"),c.drawing=!1})},start:function(a){this.p&&M.geo.distance(this.p,a)<20?this.activePath.addPoint(a):(this.trigger("start"),this.activePath=$N("path",{"class":"m-draw-path",d:"M "+a.x+","+a.y},this.options.paths||this.$svg),this.activePath.points=[a],this.paths.push(this.activePath)),this.drawing=!0,this.p=a},addPoint:function(a){M.geo.distance(this.p,a)>4&&(this.activePath.addPoint(a),this.p=a,this.checkForIntersects())},stop:function(){this.drawing=!1,this.p=null},clear:function(){this.paths.each(function(a){a.remove()}),this.paths=[],this.trigger("clear")},checkForIntersects:function(){if(this.options.intersect&&!(this.paths.length<=1))for(var a=this.paths.last(),b=a.getPoints(),c=new M.geo.Line(b[b.length-2],b[b.length-1]),d=0;d<this.paths.length-1;++d)for(var e=this.paths[d],f=e.getPoints(),g=1;g<f.length-2;++g){var h=new M.geo.Line(f[g],f[g+1]),i=M.geo.intersect(c,h);if(i)return void this.trigger("intersect",{point:i,paths:[a,e]})}}}),M.Graph=M.Class.extend({init:function(a,b,c,d){function e(b){for(var c=M.events.pointerOffset(b,a),d=0;d<h.vertices.length;++d){var e=h.vertices[d];if(M.geo.distance(c,e.posn)<18){h.dragging=e,h.dragging.posn=c,h.stable=!1,h.redraw();break}}M.$body.on("mousemove touchmove",f),M.$body.on("mouseup touchend touchcancel mouseleave",g)}function f(b){b.preventDefault(),b.stopPropagation(),h.dragging&&(h.dragging.posn=M.events.pointerOffset(b,a),h.redraw(),h.stable=!1)}function g(){h.dragging=null,M.$body.off("mousemove touchmove",f),M.$body.off("mouseup touchend touchcancel mouseleave",g)}var h=this;this.options=d=d||{},this.$edges=$N("g",{},a),this.$vertices=$N("g",{},a),this.vertices=[],this.edges=[];var i=function(){h.width=a.width(),h.height=a.height()};if(M.resize(i),i(),this.stable=!1,this.dragging=null,this.options.directed){var j=$N("defs",{},a),k=$N("marker",{id:"arrow-head",viewBox:"0 -5 10 10",refX:"14",refY:"0",markerWidth:"6",markerHeight:"6",orient:"auto"},j);$N("path",{d:"M0,-5L10,0L0,5","class":"arrow"},k)}a.on("mousedown touchstart",e),this.load(b,c,d.posn)},load:function(a,b,c){var d=this;this.repulsion=50/Math.sqrt(a),this.attraction=.1*Math.sqrt(a)/b.length*200/(this.width+this.height),this.gravity=a/4,this.damping=.9,this.$vertices.clear(),this.$edges.clear(),this.vertices=M.list(a).each(function(a){var b=c?c[a][0]||c[a].x:d.width*(.3+.4*Math.random()),e=c?c[a][1]||c[a].y:d.height*(.3+.4*Math.random()),f=d.options.icon?$N("path",{"class":"node",d:d.options.icon},d.$vertices):$N("circle",{"class":"node",r:d.options.r||5},d.$vertices);return d.options.vertex&&f.css("fill",M.run(d.options.vertex,[a])),{$el:f,posn:{x:b,y:e},neighbours:[],v:{x:0,y:0}}}),this.edges=b.each(function(a){var b=d.vertices[a[0]],c=d.vertices[a[1]],e=b===c||d.options.arc?"path":"line",f=$N(e,{"class":"link"},d.$edges);d.options.directed&&f.attr("marker-end","url(#arrow-head)"),d.options.edge&&f.css("stroke",M.run(d.options.edge,[a[0],a[1]]));var g={$el:f,vertices:[b,c]};return b.neighbours.push(c),c.neighbours.push(b),g}),this.redraw()},redraw:function(){function a(){b.stable?b.animating=!1:(M.animationFrame(a),b.physics())}var b=this;return this.options.static?void this.arrange():void(this.animating||(this.animating=!0,this.stable=!1,a()))},physics:function(){var a=this,b=[],c=0;this.vertices.each(function(d,e){if(!a.options.static&&d!==a.dragging){var f={x:0,y:0};a.vertices.each(function(b){if(b!==d){var c=M.square(d.posn.x-b.posn.x)+M.square(d.posn.y-b.posn.y);M.nearlyEquals(c,0,.001)&&(c=.001);var e=a.repulsion/c;f.x+=e*(d.posn.x-b.posn.x),f.y+=e*(d.posn.y-b.posn.y)}}),d.neighbours.each(function(b){f.x+=a.attraction*(b.posn.x-d.posn.x),f.y+=a.attraction*(b.posn.y-d.posn.y)}),f.x+=a.gravity*(.5-d.posn.x/a.width),f.y+=a.gravity*(.5-d.posn.y/a.height),d.v.x=(d.v.x+f.x)*a.damping,d.v.y=(d.v.y+f.y)*a.damping,c+=Math.abs(d.v.x)+Math.abs(d.v.y),b[e]={x:d.posn.x+d.v.x,y:d.posn.y+d.v.y}}}),this.stable=.5>c&&!this.dragging,this.arrange(b)},arrange:function(a){var b=this;a||(a=[]);var c=null;this.vertices.each(function(c,d){if(c.posn=a[d]||c.posn,b.options.bound){var e=b.options.r||5;c.posn.x=M.bound(c.posn.x,e,b.width-e),c.posn.y=M.bound(c.posn.y,e,b.height-e)}b.options.icon?c.$el.translate(c.posn.x,c.posn.y):(c.$el.attr("cx",c.posn.x),c.$el.attr("cy",c.posn.y))}),this.edges.each(function(a){if(a.vertices[0]===a.vertices[1]){c||(c=M.geo.average(b.vertices.each(function(a){return a.posn})));var d=M.Vector([a.vertices[0].posn.x-c.x,a.vertices[0].posn.y-c.y]).normalise(),e=M.vector.mult([d[0]+d[1],d[1]-d[0]],40),f=M.vector.mult([d[0]-d[1],d[1]+d[0]],40);a.$el.attr("d","M"+a.vertices[0].posn.x+","+a.vertices[0].posn.y+"c"+e[0]+","+e[1]+","+f[0]+","+f[1]+",0,0")}else if(b.options.arc){var g=a.vertices[1].posn.x-a.vertices[0].posn.x,h=a.vertices[1].posn.y-a.vertices[0].posn.y,i=Math.sqrt(g*g+h*h);a.$el.attr("d","M"+a.vertices[0].posn.x+","+a.vertices[0].posn.y+"A"+i+","+i+" 0 0,1 "+a.vertices[1].posn.x+","+a.vertices[1].posn.y)}else a.$el.attr("x1",a.vertices[0].posn.x),a.$el.attr("y1",a.vertices[0].posn.y),a.$el.attr("x2",a.vertices[1].posn.x),a.$el.attr("y2",a.vertices[1].posn.y)}),this.trigger("update")}})}();